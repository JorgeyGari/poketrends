(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();class y{constructor(){this.currentStreak=0,this.bestStreak=0,this.round=0,this.isActive=!1,this.selectedCountry="US",this.usedPokemon=[],this.totalGames=0,this.totalRounds=0}startGame(){this.currentStreak=0,this.round=0,this.isActive=!0,this.usedPokemon=[],this.totalGames++}correctGuess(){this.currentStreak++,this.round++,this.totalRounds++,this.currentStreak>this.bestStreak&&(this.bestStreak=this.currentStreak)}incorrectGuess(){this.isActive=!1,this.totalRounds++}markPokemonAsUsed(e){this.usedPokemon.includes(e)||this.usedPokemon.push(e)}isPokemonUsed(e){return this.usedPokemon.includes(e)}setSelectedCountry(e){this.selectedCountry=e}setCountry(e){return this.setSelectedCountry(e)}markPokemonUsed(e){return this.markPokemonAsUsed(e)}getStats(){return{currentStreak:this.currentStreak,bestStreak:this.bestStreak,round:this.round,totalGames:this.totalGames,totalRounds:this.totalRounds,averageStreak:this.totalGames>0?(this.totalRounds/this.totalGames).toFixed(2):0}}toJSON(){return{currentStreak:this.currentStreak,bestStreak:this.bestStreak,round:this.round,isActive:this.isActive,selectedCountry:this.selectedCountry,usedPokemon:this.usedPokemon,totalGames:this.totalGames,totalRounds:this.totalRounds}}fromJSON(e){if(!e)return;let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){console.error("GameState.fromJSON: failed to parse string, ignoring",s);return}this.currentStreak=t.currentStreak||0,this.bestStreak=t.bestStreak||0,this.round=t.round||0,this.isActive=t.isActive||!1,this.selectedCountry=t.selectedCountry||"US",this.usedPokemon=t.usedPokemon||[],this.totalGames=t.totalGames||0,this.totalRounds=t.totalRounds||0}}class S{constructor(e,t,s,a=null){this.id=e,this.name=t,this.prettyName=null,this.generation=s,this.popularityScore=a,this.sprite=null,this.estimatedSearches=null,this.estimatedLabel=null,this.timelineSum=null,this.timelineValues=null,this.avgScore=null}setPopularityScore(e){this.popularityScore=e}setEstimatedSearches(e,t=null){this.estimatedSearches=typeof e=="number"?e:null,this.estimatedLabel=t||null}setTimelineData(e,t=null){this.timelineSum=e!=null?Number(e):null,this.timelineValues=Array.isArray(t)?t.map(s=>Number(s)):null}setAvgScore(e){this.avgScore=e!=null?Number(e):null}setSpriteUrl(e){this.sprite=e}getSpriteUrl(){return`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${this.id}.png`}isComplete(){return this.id!==null&&this.name!==null&&this.popularityScore!==null&&this.sprite!==null}getDisplayName(){return this.prettyName&&typeof this.prettyName=="string"?this.prettyName:(this.name||"").replace(/-/g," ").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}static fromData(e){const t=new S(e.id,e.name,e.generation,e.popularityScore);if(e.sprite&&t.setSpriteUrl(e.sprite),e.estimatedSearches&&t.setEstimatedSearches(e.estimatedSearches,e.estimatedLabel),e.timelineSum!==void 0&&t.setTimelineData(e.timelineSum,e.timelineValues),e.avgScore!==void 0&&t.setAvgScore(e.avgScore),e.prettyName)t.prettyName=e.prettyName;else if(e.speciesName){const s=(e.speciesName||"").replace(/[-_]+/g," ");t.prettyName=s.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}return t}}const p={MAX_ROUNDS:10,ROUND_DELAY:3e3,ANIMATION_DURATION:500,POKEMON_LIMIT:0},b=[{code:"ES",name:"Espa√±a",flag:"üá™üá∏"},{code:"JP",name:"Êó•Êú¨",flag:"üáØüáµ"},{code:"US",name:"United States",flag:"üá∫üá∏"},{code:"DE",name:"Deutschland",flag:"üá©üá™"},{code:"GB",name:"United Kingdom",flag:"üá¨üáß"},{code:"FR",name:"France",flag:"üá´üá∑"},{code:"BR",name:"Brasil",flag:"üáßüá∑"},{code:"MX",name:"M√©xico",flag:"üá≤üáΩ"},{code:"AR",name:"Argentina",flag:"üá¶üá∑"},{code:"IT",name:"Italia",flag:"üáÆüáπ"},{code:"CA",name:"Canada",flag:"üá®üá¶"},{code:"AU",name:"Australia",flag:"üá¶üá∫"}],m={BEST_STREAK:"bestStreak",SELECTED_COUNTRY:"selectedCountry",GAME_STATS:"gameStats",POKEMON_CACHE:"pokemonCache"},P={POKEAPI:"https://pokeapi.co/api/v2"};class u{static saveStats(e){try{localStorage.setItem(m.GAME_STATS,JSON.stringify(e))}catch(t){console.error("Error saving game statistics:",t)}}static loadStats(){try{const e=localStorage.getItem(m.GAME_STATS);return e?JSON.parse(e):null}catch(e){return console.error("Error loading game statistics:",e),null}}static saveSelectedCountry(e){try{localStorage.setItem(m.SELECTED_COUNTRY,e)}catch(t){console.error("Error saving selected country:",t)}}static loadSelectedCountry(){try{return localStorage.getItem(m.SELECTED_COUNTRY)}catch(e){return console.error("Error loading selected country:",e,'(returning default "US")'),"US"}}static saveCountry(e){return this.saveSelectedCountry(e)}static loadCountry(){return this.loadSelectedCountry()}static savePokemonCache(e){try{localStorage.setItem(m.POKEMON_CACHE,JSON.stringify(e))}catch(t){console.error("Error saving Pok√©mon cache:",t)}}static loadPokemonCache(){try{const e=localStorage.getItem(m.POKEMON_CACHE);return e?JSON.parse(e):null}catch(e){return console.error("Error loading Pok√©mon cache:",e),null}}static savePokemonList(e){return this.savePokemonCache(e)}static loadPokemonList(){return this.loadPokemonCache()}static clearPokemonList(){try{localStorage.removeItem(m.POKEMON_CACHE)}catch(e){console.error("Error clearing Pok√©mon cache:",e)}}static clearAll(){Object.values(m).forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.error(`Error clearing storage key ${e}:`,t)}})}}class C{constructor(){this.baseUrl=P.POKEAPI,this.detailsCache=new Map,this.listCache=null}async fetchPokemonList(e=p.POKEMON_LIMIT,t=0){try{const s=u.loadPokemonList();if(s&&e>0)return s;let a=e;if(!a||a<=0){const o=`${this.baseUrl}/pokemon?limit=1&offset=0`,c=await fetch(o);if(!c.ok)throw new Error("Failed to fetch Pok√©mon meta count");a=(await c.json()).count||0}const r=`${this.baseUrl}/pokemon-species?limit=${a}&offset=${t}`,i=await fetch(r);if(!i.ok)throw new Error("Failed to fetch Pok√©mon species list");const n=(await i.json()).results.map(o=>({name:o.name,url:o.url}));return u.savePokemonList(n),this.listCache=n,n}catch(s){return console.error("Error fetching Pok√©mon list:",s),[]}}async getPokemonDetails(e){try{if(this.detailsCache.has(e))return this.detailsCache.get(e);let t=await fetch(`${this.baseUrl}/pokemon/${e}`),s=null;if(!t.ok)try{const l=await fetch(`${this.baseUrl}/pokemon-species/${e}`);if(l.ok){const o=((await l.json()).varieties||[]).find(d=>d.is_default===!0),c=o&&o.pokemon&&o.pokemon.name;c&&(t=await fetch(`${this.baseUrl}/pokemon/${c}`))}}catch{}if(!t.ok)throw new Error(`Failed to fetch details for Pok√©mon: ${e}`);s=await t.json();let a=null,r=s.species&&s.species.name?s.species.name:typeof s.name=="string"?s.name.split("-")[0]:null;try{if(s.species&&s.species.url){const l=await fetch(s.species.url);if(l.ok){const n=await l.json(),o=(n.names||[]).find(c=>c.language&&c.language.name==="en");o&&o.name&&(a=o.name),n&&n.name&&(r=n.name),!a&&n&&n.name&&(a=this.formatDisplayName(n.name))}}}catch{}!a&&r&&(a=this.formatDisplayName(r));const i={id:s.id,name:s.name,speciesName:r||null,prettyName:a||null,sprite:s.sprites.other["official-artwork"].front_default||s.sprites.front_default,types:s.types.map(l=>l.type.name),generation:this.getGenerationById(s.id),baseExperience:s.base_experience};return this.detailsCache.set(s.name,i),this.detailsCache.set(e,i),i}catch(t){return console.error(`Error fetching details for Pok√©mon (${e}):`,t),null}}async getBatchPokemonDetails(e){const t=e.map(a=>this.getPokemonDetails(a).catch(()=>null));return(await Promise.all(t)).filter(a=>a!==null)}getGenerationById(e){return e<=151?1:e<=251?2:e<=386?3:e<=493?4:e<=649?5:e<=721?6:e<=809?7:e<=905?8:9}formatDisplayName(e){return e?e.replace(/[_-]+/g," ").split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}clearCache(){this.detailsCache.clear(),this.listCache=null,u.clearPokemonList()}}class E{constructor(){const e="http://localhost:3002";this.apiUrl=`${e}/trends`,this.cache=new Map}async getTrendsScore(e,t="US"){const s=`${e}_${t}`;if(this.cache.has(s))return this.cache.get(s);try{const a=`${this.apiUrl}?pokemonName=${encodeURIComponent(e)}&countryCode=${t}`,r=await fetch(a);if(!r.ok)throw new Error(`API returned ${r.status}`);const i=await r.json();return this.cache.set(s,i),i.cached?console.log(`üì¶ Cached trends: ${e} = ${i.score}`):i.fallback?console.log(`‚ö†Ô∏è Fallback trends: ${e} = ${i.score}`):console.log(`‚úÖ Real trends: ${e} = ${i.score}`),i}catch(a){return console.error(`Error fetching trends for ${e}:`,a),{score:this.getFallbackScore(e),fallback:!0}}}async getBatchScores(e,t="US"){const s=new Map;for(const a of e){await this.delay(300);const r=await this.getTrendsScore(a,t);s.set(a,r)}return s}getFallbackScore(e){return 30+e.split("").reduce((s,a)=>s+a.charCodeAt(0),0)%50}delay(e){return new Promise(t=>setTimeout(t,e))}clearCache(){this.cache.clear()}async checkHealth(){try{const t=await(await fetch("http://localhost:3002/health")).text();let s;try{s=JSON.parse(t)}catch{return console.error("‚ùå Backend health returned non-JSON:",t),!1}return console.log("üè• Backend health:",s),s.status==="ok"}catch(e){return console.error("‚ùå Backend not reachable:",e.message),!1}}}class L{constructor(){this.pokemonService=new C,this.trends=new E}async getPopularityScore(e,t="US"){try{const s=await this.trends.getTrendsScore(e,t);return s&&typeof s=="object"?{score:typeof s.score=="number"?s.score:this.getFallbackFromPokemon(e),avgScore:s.avgScore!=null?Number(s.avgScore):null,estimatedSearches:s.estimatedSearches!=null?Number(s.estimatedSearches):null,estimatedLabel:s.estimatedLabel||null,timelineValues:Array.isArray(s.timelineValues)?s.timelineValues.map(r=>Number(r)):null,timelineSum:s.timelineSum!=null?Number(s.timelineSum):null,rawData:s.rawData||null,cached:!!s.cached,fallback:!!s.fallback}:{score:await this.getFallbackFromPokemon(e),estimatedSearches:null,estimatedLabel:null,fallback:!0}}catch(s){return console.warn("PopularityService: trends fetch failed, falling back",s),{score:await this.getFallbackFromPokemon(e),estimatedSearches:null,estimatedLabel:null,fallback:!0}}}clearCache(){this.trends&&typeof this.trends.clearCache=="function"&&this.trends.clearCache()}async getFallbackFromPokemon(e){try{const s=await this.pokemonService.getPokemonDetails(e);if(s&&typeof s.baseExperience=="number"){const a=s.baseExperience;return Math.min(100,Math.round(a/300*100))}}catch(s){console.error("PopularityService fallback failed:",s)}return 30+e.split("").reduce((s,a)=>s+a.charCodeAt(0),0)%50}}class w{constructor(e){this.uiController=e,this.gameState=new y,this.pokemonService=new C,this.popularityService=new L,this.currentPair=null,this.pokemonList=null,this.buffer=[],this.BUFFER_SIZE=3,this.loadSavedData()}loadSavedData(){const e=u.loadStats();e&&this.gameState.fromJSON(e);const t=u.loadCountry();this.gameState.setCountry(t)}async initializeGame(){try{if(this.uiController.showLoading(),this.pokemonList=await this.pokemonService.fetchPokemonList(p.POKEMON_LIMIT),!this.pokemonList||this.pokemonList.length<2)throw new Error("Failed to load Pok√©mon");this.uiController.hideLoading()}catch(e){console.error("Error initializing game:",e),this.uiController.showError("Error cargando Pok√©mon. Intenta recargar la p√°gina.")}}async startGame(){this.gameState.startGame(),this.uiController.updateStats(this.gameState.getStats()),await this.initializeBuffer(),await this.loadNextRound()}async loadNextRound(){try{(!this.buffer||this.buffer.length<2)&&await this.initializeBuffer();const e=this.buffer[0],t=this.buffer[1];this.currentPair={left:e,right:t},this.uiController.displayPokemonPair(e,t,!1);const s=this.gameState.selectedCountry,[a,r]=await Promise.all([this.popularityService.getPopularityScore(e.name,s),this.popularityService.getPopularityScore(t.name,s)]);a&&(e.setPopularityScore(a.score),typeof e.setEstimatedSearches=="function"&&e.setEstimatedSearches(a.estimatedSearches,a.estimatedLabel),typeof e.setTimelineData=="function"&&e.setTimelineData(a.timelineSum,a.timelineValues),typeof e.setAvgScore=="function"&&e.setAvgScore(a.avgScore)),r&&(t.setPopularityScore(r.score),typeof t.setEstimatedSearches=="function"&&t.setEstimatedSearches(r.estimatedSearches,r.estimatedLabel),typeof t.setTimelineData=="function"&&t.setTimelineData(r.timelineSum,r.timelineValues),typeof t.setAvgScore=="function"&&t.setAvgScore(r.avgScore)),this.uiController.enableClicks()}catch(e){console.error("Error loading round:",e),this.uiController.showError("Error cargando datos. Intenta de nuevo.")}}async initializeBuffer(){if(this.buffer=[],!this.pokemonList||this.pokemonList.length===0)return;let e=this.pokemonList.filter(r=>!this.gameState.isPokemonUsed(r.name));e.length<this.BUFFER_SIZE&&(this.gameState.usedPokemon=[],e=[...this.pokemonList]);const s=e.sort(()=>.5-Math.random()).slice(0,this.BUFFER_SIZE);s.forEach(r=>this.gameState.markPokemonUsed(r.name)),(await Promise.all(s.map(r=>this.pokemonService.getPokemonDetails(r.name)))).forEach(r=>{r&&this.buffer.push(this.createPokemonModel(r))})}async fetchUniquePokemonModel(){if(!this.pokemonList||this.pokemonList.length===0)return null;let e=this.pokemonList.filter(r=>!this.gameState.isPokemonUsed(r.name));e.length===0&&(this.gameState.usedPokemon=[],e=[...this.pokemonList]);const s=e.sort(()=>.5-Math.random())[0];this.gameState.markPokemonUsed(s.name);const a=await this.pokemonService.getPokemonDetails(s.name);return a?this.createPokemonModel(a):null}async ensurePopularity(e){if(typeof e.popularityScore<"u"&&e.popularityScore!==null)return;const t=this.gameState.selectedCountry,s=await this.popularityService.getPopularityScore(e.name,t);s&&(typeof e.setPopularityScore=="function"&&e.setPopularityScore(s.score),typeof e.setEstimatedSearches=="function"&&e.setEstimatedSearches(s.estimatedSearches,s.estimatedLabel),typeof e.setTimelineData=="function"&&e.setTimelineData(s.timelineSum,s.timelineValues),typeof e.setAvgScore=="function"&&e.setAvgScore(s.avgScore))}async getRandomPokemonPair(){let e=this.pokemonList.filter(l=>!this.gameState.isPokemonUsed(l.name));e.length<2&&(this.gameState.usedPokemon=[],e=[...this.pokemonList]);const t=e.sort(()=>.5-Math.random()),[s,a]=t.slice(0,2);this.gameState.markPokemonUsed(s.name),this.gameState.markPokemonUsed(a.name);const r=await this.pokemonService.getPokemonDetails(s.name),i=await this.pokemonService.getPokemonDetails(a.name);if(!r||!i)throw new Error("Failed to get Pok√©mon details");return[this.createPokemonModel(r),this.createPokemonModel(i)]}createPokemonModel(e){const t=e.speciesName||e.name,s=new S(e.id,t,e.generation);e.prettyName&&(s.prettyName=e.prettyName);const a=e.sprite||s.getSpriteUrl?.();return a&&typeof s.setSpriteUrl=="function"&&s.setSpriteUrl(a),s}async handleGuess(e){if(!this.gameState.isActive)return;const t=this.currentPair.left.popularityScore,s=this.currentPair.right.popularityScore,a=e==="left"&&t>=s||e==="right"&&s>=t;this.uiController.revealScores(this.currentPair.left,this.currentPair.right,e,a),a?(this.gameState.correctGuess(),this.uiController.updateStats(this.gameState.getStats()),this.saveProgress(),setTimeout(async()=>{try{this.buffer&&this.buffer[1]&&(this.buffer[1].keepRevealed=!0),this.buffer.shift();const r=await this.fetchUniquePokemonModel();r&&this.buffer.push(r),await this.loadNextRound()}catch(r){console.error("Error preparing next buffered round:",r),this.loadNextRound()}},p.ROUND_DELAY)):(this.gameState.incorrectGuess(),this.saveProgress(),setTimeout(()=>{this.uiController.showGameOver(this.gameState.getStats())},p.ROUND_DELAY))}changeCountry(e){this.gameState.setCountry(e),u.saveCountry(e),this.popularityService.clearCache(),this.gameState.isActive&&this.startGame()}saveProgress(){u.saveStats(this.gameState.toJSON())}resetStats(){u.clearAll(),this.popularityService.clearCache(),this.gameState=new y,this.uiController.updateStats(this.gameState.getStats())}}class N{constructor(){this.container=null,this.leftCard=null,this.rightCard=null,this.guessCallback=null}mount(e){this.container=document.querySelector(e),this.render(),this.attachEventListeners()}render(){this.container.innerHTML=`
      <div class="game-board">
        <div class="loading-overlay" id="loading">
          <div class="spinner"></div>
          <p>Cargando...</p>
        </div>

        <div class="pokemon-cards">
          <div class="pokemon-card" id="card-left" data-side="left">
            <div class="pokemon-sprite">
              <img id="sprite-left" alt="" />
            </div>
            <h2 class="pokemon-name" id="name-left"></h2>
            <div class="pokemon-gen" id="gen-left"></div>
            <div class="popularity-score hidden" id="score-left">
              <span class="score-label">B√∫squedas estimadas</span>
              <div class="score-main">
                <span class="score-value"></span>
              </div>
              <div class="score-sub">
                <span class="score-sub-label">Popularidad:</span>
                <span class="score-avg"></span>
              </div>
            </div>
          </div>

          <div class="vs-divider">
            <span>VS</span>
          </div>

          <div class="pokemon-card" id="card-right" data-side="right">
            <div class="pokemon-sprite">
              <img id="sprite-right" alt="" />
            </div>
            <h2 class="pokemon-name" id="name-right"></h2>
            <div class="pokemon-gen" id="gen-right"></div>
            <div class="popularity-score hidden" id="score-right">
              <span class="score-label">B√∫squedas estimadas</span>
              <div class="score-main">
                <span class="score-value"></span>
              </div>
              <div class="score-sub">
                <span class="score-sub-label">Popularidad:</span>
                <span class="score-avg"></span>
              </div>
            </div>
          </div>
        </div>

        <p class="instruction">Haz clic en el Pok√©mon m√°s popular</p>
      </div>
    `,this.leftCard=this.container.querySelector("#card-left"),this.rightCard=this.container.querySelector("#card-right")}attachEventListeners(){this.leftCard.addEventListener("click",()=>this.handleClick("left")),this.rightCard.addEventListener("click",()=>this.handleClick("right"))}handleClick(e){this.guessCallback&&!this.leftCard.classList.contains("disabled")&&this.guessCallback(e)}setPokemon(e,t,s={}){document.getElementById("sprite-left").src=e.sprite,document.getElementById("sprite-left").alt=e.name,document.getElementById("name-left").textContent=e.getDisplayName(),document.getElementById("gen-left").textContent=`Gen ${e.generation}`,document.getElementById("sprite-right").src=t.sprite,document.getElementById("sprite-right").alt=t.name,document.getElementById("name-right").textContent=t.getDisplayName(),document.getElementById("gen-right").textContent=`Gen ${t.generation}`;const a=!!s.preserveLeft,r=!!s.preserveRight;this.resetCards(a,r,e,t)}revealScores(e,t){const s=document.querySelector("#score-left .score-value"),a=document.querySelector("#score-right .score-value"),r=document.querySelector("#score-left .score-avg"),i=document.querySelector("#score-right .score-avg"),l=typeof e.estimatedSearches=="number"&&e.estimatedSearches!=null?e.estimatedSearches:typeof e.timelineSum=="number"?e.timelineSum:Math.round(e.popularityScore||0),n=typeof t.estimatedSearches=="number"&&t.estimatedSearches!=null?t.estimatedSearches:typeof t.timelineSum=="number"?t.timelineSum:Math.round(t.popularityScore||0),o=!!e&&!!e.keepRevealed,c=!!t&&!!t.keepRevealed;o?s.textContent=this.formatNumber(l,0):this.animateCount(s,l,900,0),c?a.textContent=this.formatNumber(n,0):this.animateCount(a,n,900,0);const d=e.avgScore!=null?Number(e.avgScore):null,f=t.avgScore!=null?Number(t.avgScore):null;r&&(d!=null?o?r.textContent=this.formatNumber(d,2):this.animateCount(r,d,700,2):r.textContent=""),i&&(f!=null?c?i.textContent=this.formatNumber(f,2):this.animateCount(i,f,700,2):i.textContent=""),document.getElementById("score-left").classList.remove("hidden"),document.getElementById("score-right").classList.remove("hidden"),e&&e.keepRevealed&&delete e.keepRevealed,t&&t.keepRevealed&&delete t.keepRevealed}formatNumber(e,t=0){return typeof e!="number"?"":e.toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:t})}animateCount(e,t,s=800,a=0){if(!e)return;const r=0,i=performance.now(),l=this;function n(o){const c=o-i,d=Math.min(1,c/s),f=1-Math.pow(1-d,3),g=r+(t-r)*f,k=a>0?Number(g.toFixed(a)):Math.round(g);e.textContent=l.formatNumber(k,a),d<1&&requestAnimationFrame(n)}requestAnimationFrame(n)}highlightResult(e,t){const s=e==="left"?this.leftCard:this.rightCard,a=e==="left"?this.rightCard:this.leftCard;t?s.classList.add("correct"):(s.classList.add("incorrect"),a.classList.add("correct"))}resetCards(e=!1,t=!1,s=null,a=null){[this.leftCard,this.rightCard].forEach(n=>{n.classList.remove("correct","incorrect","disabled")});const r=document.getElementById("score-left"),i=document.getElementById("score-right"),l=(n,o)=>{if(!n||!o)return;const c=n.querySelector(".score-value"),d=n.querySelector(".score-avg"),f=typeof o.estimatedSearches=="number"&&o.estimatedSearches!=null?o.estimatedSearches:typeof o.timelineSum=="number"?o.timelineSum:Math.round(o.popularityScore||0),g=o.avgScore!=null?Number(o.avgScore):null;c&&(c.textContent=this.formatNumber(f,0)),d&&(d.textContent=g!=null?this.formatNumber(g,2):""),n.classList.remove("hidden")};e&&s?l(r,s):r&&r.classList.add("hidden"),t&&a?l(i,a):i&&i.classList.add("hidden")}enableClicks(){[this.leftCard,this.rightCard].forEach(e=>{e.classList.remove("disabled")})}disableClicks(){[this.leftCard,this.rightCard].forEach(e=>{e.classList.add("disabled")})}showLoading(){document.getElementById("loading").classList.add("active")}hideLoading(){document.getElementById("loading").classList.remove("active")}setGuessCallback(e){this.guessCallback=e}}class A{constructor(){this.container=null}mount(e){this.container=document.querySelector(e),this.render()}render(){this.container.innerHTML=`
      <div class="stats-panel">
        <div class="stat-item">
          <span class="stat-label">Racha</span>
          <span class="stat-value" id="stat-streak">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Mejor</span>
          <span class="stat-value" id="stat-best">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Ronda</span>
          <span class="stat-value" id="stat-round">1</span>
        </div>
      </div>
    `}update(e){document.getElementById("stat-streak").textContent=e.currentStreak,document.getElementById("stat-best").textContent=e.bestStreak,document.getElementById("stat-round").textContent=e.round}}class I{constructor(){this.container=null,this.changeCallback=null}mount(e){this.container=document.querySelector(e),this.render(),this.attachEventListeners()}render(){const e=b.map(t=>`
      <option value="${t.code}">
        ${t.flag} ${t.name}
      </option>
    `).join("");this.container.innerHTML=`
      <div class="country-selector">
        <label for="country-select">
          <span class="icon">üåç</span>
          Pa√≠s:
        </label>
        <select id="country-select" class="country-select">
          ${e}
        </select>
      </div>
    `}attachEventListeners(){this.container.querySelector("#country-select").addEventListener("change",t=>{this.changeCallback&&this.changeCallback(t.target.value)})}setChangeCallback(e){this.changeCallback=e}setSelected(e){const t=this.container.querySelector("#country-select");t&&(t.value=e)}}class U{constructor(){this.modal=null,this.init()}init(){document.body.insertAdjacentHTML("beforeend",`
      <div class="modal" id="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="modal-title"></h2>
            <button class="modal-close" id="modal-close">&times;</button>
          </div>
          <div class="modal-body" id="modal-body"></div>
          <div class="modal-footer" id="modal-footer"></div>
        </div>
      </div>
    `),this.modal=document.getElementById("modal"),document.getElementById("modal-close").addEventListener("click",()=>{this.hide()}),this.modal.querySelector(".modal-overlay").addEventListener("click",()=>{this.hide()})}show(e){document.getElementById("modal-title").textContent=e.title,document.getElementById("modal-body").innerHTML=e.content;const t=document.getElementById("modal-footer");t.innerHTML="",e.buttons&&e.buttons.forEach(s=>{const a=document.createElement("button");a.textContent=s.text,a.className=s.primary?"btn-primary":"btn-secondary",a.addEventListener("click",()=>{s.action(),this.hide()}),t.appendChild(a)}),this.modal.classList.add("active")}hide(){this.modal.classList.remove("active")}}class R{constructor(){this.gameBoard=new N,this.statsPanel=new A,this.countrySelector=new I,this.modal=new U,this.initializeUI()}initializeUI(){this.gameBoard.mount("#game-container"),this.statsPanel.mount("#stats-container"),this.countrySelector.mount("#country-selector-container")}displayPokemonPair(e,t,s=!0){const a=!!e&&!!e.keepRevealed,r=!!t&&!!t.keepRevealed;this.gameBoard.setPokemon(e,t,{preserveLeft:a,preserveRight:r}),s?this.gameBoard.enableClicks():this.gameBoard.disableClicks()}enableClicks(){this.gameBoard.enableClicks()}disableClicks(){this.gameBoard.disableClicks()}revealScores(e,t,s,a){this.gameBoard.disableClicks(),this.gameBoard.revealScores(e,t),this.gameBoard.highlightResult(s,a)}updateStats(e){this.statsPanel.update(e)}showLoading(){this.gameBoard.showLoading()}hideLoading(){this.gameBoard.hideLoading()}showError(e){this.modal.show({title:"Error",content:`
        <p>${e}</p>
      `,buttons:[{text:"Cerrar",action:()=>{},primary:!0}]})}showGameOver(e){this.modal.show({title:"¬°Fin de la partida!",content:`
        <div class="game-over-content">
          <p class="final-score">Racha final: <strong>${e.currentStreak}</strong></p>
          <p>Mejor racha: <strong>${e.bestStreak}</strong></p>
          <p>Promedio: <strong>${e.averageStreak}</strong> por partida</p>
        </div>
      `,buttons:[{text:"Otra partida",action:()=>this.onRestartGame(),primary:!0}]})}setRestartCallback(e){this.onRestartGame=e}setGuessCallback(e){this.gameBoard.setGuessCallback(e)}setCountryChangeCallback(e){this.countrySelector.setChangeCallback(e)}}class v{constructor(){this.init()}async init(){try{this.uiController=new R,this.gameController=new w(this.uiController),u.clearPokemonList(),this.gameController&&this.gameController.pokemonService&&this.gameController.pokemonService.clearCache(),this.uiController.setGuessCallback(t=>{this.gameController.handleGuess(t)}),this.uiController.setRestartCallback(()=>{this.gameController.startGame()}),this.uiController.setCountryChangeCallback(t=>{this.gameController.changeCountry(t)});const e=u.loadCountry();this.uiController.countrySelector.setSelected(e),await this.gameController.initializeGame(),await this.gameController.startGame()}catch(e){console.error("Fatal error initializing app:",e),this.uiController.showError("Error al inicializar la aplicaci√≥n. Por favor, recarga la p√°gina.")}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new v):new v;
